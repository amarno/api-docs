# Cart Activity

Passing in all required fields for Cart Activity will enable Cart Abandonment Dynamic Content in your Drip account. Leverage that content in our Visual Email Builder to send Cart Abandonment emails containing item details.

Note that Cart Activity will show up on a person's activity timeline as either a "Created a cart" or "Updated a cart" event. For more information, see our Knowledge Base [here](https://help.drip.com/hc/en-us/articles/360022922031).

## Create or update a cart

> To record a cart event:

```shell
curl -X POST "https://api.getdrip.com/v3/YOUR_ACCOUNT_ID/shopper_activity/cart" \
  -H "Content-Type: application/json" \
  -H 'User-Agent: Your App Name (www.yourapp.com)' \
  -u YOUR_API_KEY: \
  -d @- << EOF
  {
    "provider": "my_custom_platform",
    "email": "user@gmail.com",
    "action": "created",
    "cart_id": "456445746",
    "occurred_at": "2019-01-17T20:50:00Z",
    "cart_public_id": "#5",
    "grand_total": 16.99,
    "total_discounts": 5.34,
    "currency": "USD",
    "cart_url": "https://mysuperstore.com/cart/456445746",
    "items": [
      {
        "product_id": "B01J4SWO1G",
        "product_variant_id": "B01J4SWO1G-CW-BOTT",
        "sku": "XHB-1234",
        "name": "The Coolest Water Bottle",
        "brand": "Drip",
        "categories": [
          "Accessories"
        ],
        "price": 11.16,
        "quantity": 2,
        "discount": 5.34,
        "total": 16.99,
        "product_url": "https://mysuperstore.com/dp/B01J4SWO1G",
        "image_url": "https://www.getdrip.com/images/example_products/water_bottle.png",
        "product_tag": "Best Seller"
      }
    ]
  }
  EOF
```

```ruby
require 'drip'

client = Drip::Client.new do |c|
  c.api_key = "YOUR API KEY"
  c.account_id = "YOUR_ACCOUNT_ID"
end

response = client.create_cart_activity_event(
  provider: "my_custom_platform",
  email: "user@gmail.com", # or person_id
  action: "created",
  cart_id: "456445746",
  occurred_at: "2019-01-17T20:50:00Z",
  cart_public_id: "#5",
  grand_total: 16.99,
  total_discounts: 5.34,
  currency: "USD",
  cart_url: "https://mysuperstore.example.com/cart/456445746",
  items: [
    {
      product_id: "B01J4SWO1G",
      product_variant_id: "B01J4SWO1G-CW-BOTT",
      sku: "XHB-1234",
      name: "The Coolest Water Bottle",
      brand: "Drip",
      categories: [
        "Accessories"
      ],
      price: 11.16,
      quantity: 2,
      discount: 5.34,
      total: 16.99,
      product_url: "https://mysuperstore.com/dp/B01J4SWO1G",
      image_url: "https://www.getdrip.com/images/example_products/water_bottle.png",
      product_tag: "Best Seller"
    }
  ]
)

if response.success?
  puts "Request accepted"
else
  puts "Error occurred"
end
```

> Responds with a <code>202 Accepted</code> if successful. That means the server accepted the request and queued it for processing. The response includes a unique request_id:

```json
{
  "request_id": "990c99a7-5cba-42e8-8f36-aec3419186ef"
}
```

### HTTP Endpoint

`POST /v3/:account_id/shopper_activity/cart`

### Arguments

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>provider</code></td>
      <td>Required. The identifier for the provider from which the order data was received in lower snake cased form. For example, <code>shopify</code> or <code>my_custom_platform</code> or <code>my_store</code>.</td>
    </tr>
    <tr>
      <td><code>person_id</code></td>
      <td>Optional. The unique identifier of a person at Drip. Either <code>person_id</code> or <code>email</code> must be included. If both are included, <code>email</code> is ignored.</td>
    </tr>
    <tr>
      <td><code>email</code></td>
      <td>Optional. The person's email address. Either <code>person_id</code> or <code>email</code> must be included. If both are included, <code>email</code> is ignored.</td>
    </tr>
    <tr>
      <td><code>action</code></td>
      <td>Required. The event's action. For Cart Activity, this can be either <code>created</code> or <code>updated</code>. <code>created</code> will trigger a "Created a Cart" event on a person's timeline. <code>updated</code> will trigger an "Updated a Cart" event.</td>
    </tr>
    <tr>
      <td><code>cart_id</code></td>
      <td>Required. A unique, internal id for the cart (generally the primary key generated by the ecommerce platform).</td>
    </tr>
    <tr>
      <td><code>occurred_at</code></td>
      <td>Optional. The String time at which the order occurred in <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format. Defaults to the current time.</td>
    </tr>
    <tr>
      <td><code>cart_public_id</code></td>
      <td>Optional. A public, customer-facing identifier for the cart. This will be displayed in the Drip UI and should correspond to the identifier a customer might see in their own cart.</td>
    </tr>
    <tr>
      <td><code>grand_total</code></td>
      <td>Optional. The total amount of the cart. This should include any applicable discounts. Defaults to 0.</td>
    </tr>
    <tr>
      <td><code>total_discounts</code></td>
      <td>Optional. The discount on the entire order. Defaults to 0.</td>
    </tr>
    <tr>
      <td><code>currency</code></td>
      <td>Optional. The alphabetic <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a> code for the currency of the purchase.</td>
    </tr>
    <tr>
      <td><code>cart_url</code></td>
      <td>Required. A URL that links back to the shopperâ€™s cart on your ecommerce platform.</td>
    </tr>
    <tr>
      <td><code>items</code></td>
      <td>
        An Array of objects containing information about specific cart items.
        <br><br>
        <table>
          <thead>
            <tr>
              <th>Key</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>product_id</code></td>
              <td>Required. A unique identifier for the product from the <code>provider</code>.</td>
            </tr>
            <tr>
              <td><code>product_variant_id</code></td>
              <td>Optional. If applicable, a unique identifier for the specific product variant from the provider. For example, a t-shirt may have one product_id, but several product_variant_ids for sizes and colors.</td>
            </tr>
            <tr>
              <td><code>sku</code></td>
              <td>Optional. The product SKU.</td>
            </tr>
            <tr>
              <td><code>name</code></td>
              <td>Required. The product name.</td>
            </tr>
            <tr>
              <td><code>brand</code></td>
              <td>Optional. The product's brand, vendor, or manufacturer.</td>
            </tr>
            <tr>
              <td><code>categories</code></td>
              <td>Optional. An array of categories associated with the product (e.g. shoes, vitamins, books, videos).</td>
            </tr>
            <tr>
              <td><code>price</code></td>
              <td>Required. The price of a single product.</td>
            </tr>
            <tr>
              <td><code>quantity</code></td>
              <td>Optional. The quantity of the item ordered. Defaults to 1.</td>
            </tr>
            <tr>
              <td><code>discount</code></td>
              <td>Optional. The discount on the items, taking quantity into account. For example, a $2.66 discount per item would be $5.34 if that item was of quantity 2. Defaults to 0.</td>
            </tr>
            <tr>
              <td><code>total</code></td>
              <td>Optional. The line item total after quantity and discount. Defaults to 0.</td>
            </tr>
            <tr>
              <td><code>product_url</code></td>
              <td>Optional. A URL to the site containing product details.</td>
            </tr>
            <tr>
              <td><code>image_url</code></td>
              <td>Optional. A direct URL to an image of the  product. We recommend using an image type that is supported by modern email clients (e.g. JPEG, GIF, PNG). For best display results, image size should be consistent across all products.</td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
  </tbody>
</table>

The API will also allow custom attributes to be passed in. These will be exposed within Drip just like [event properties](https://help.drip.com/hc/en-us/articles/115003737312-Event-Properties).

For example, if your platform includes the concept of product tags, you can include a product_tag attribute in the JSON that can be used in a Drip automation or email [via Liquid](https://help.drip.com/hc/en-us/articles/115003737312-Event-Properties#access-properties). You can attach custom attributes either to events or their items.
